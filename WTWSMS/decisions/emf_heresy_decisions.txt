# -*- ck2.decisions -*-

decisions = {
	
	# Miaphysite

	miaphysite_desert_father = {
		potential = {
			is_adult = yes
			OR = {
				religion = miaphysite
				religion = monophysite
			}
			NOR = {
				rightful_religious_head = ROOT
				trait = desert_father
				trait = desert_mother
				trait = monk
				trait = nun
			}
			controls_religion = no
			is_nomadic = no
		}
		allow = {
			war = no
			is_ill = no
			prisoner = no
			is_pregnant = no
			NOR = {
				trait = ambitious
				trait = proud
				trait = cynical
				trait = incapable
				trait = infirm
				any_liege = { war = yes }
			}
		}
		effect = {
			any_spouse = { remove_spouse = ROOT }
			set_character_flag = is_desert_mother_father
			if = {
				limit = { is_ruler = yes }
				abdicate = yes
			}
			add_trait = chaste
			if = {
				limit = { is_female = no }
				change_learning = 1
				add_trait = desert_father
				set_character_flag = title_desert_father
				set_special_character_title = DESERT_FATHER_TITLE
			}
			if = {
				limit = { is_female = yes }
				change_learning = 1
				add_trait = desert_mother
				set_character_flag = title_desert_mother
				set_special_character_title = DESERT_MOTHER_TITLE
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05
				always = yes
			}
			modifier = {
				factor = 10
				has_character_modifier = voice_of_jesus
			}
			modifier = {
				factor = 3
				trait = zealous
			}
			modifier = {
				factor = 0.5
				trait = detached_priest
			}
			modifier = {
				factor = 2
				trait = scholarly_theologian
			}
			modifier = {
				factor = 3
				trait = mastermind_theologian
			}
			modifier = {
				factor = 0.5
				trait = proud
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
			modifier = {
				factor = 1.5
				trait = humble
			}
			modifier = {
				factor = 1.5
				trait = content
			}
			modifier = {
				factor = 0.25
				OR = {
					father_even_if_dead = { higher_tier_than = COUNT }
					mother_even_if_dead = { higher_tier_than = COUNT }
				}
			}
			modifier = {
				factor = 0
				OR = {
					is_theocracy = yes
					is_councillor = yes
					trait = stressed
					trait = depressed
					trait = hedonist
					trait = sympathy_islam
					trait = sympathy_pagans
					trait = sympathy_zoroastrianism
					trait = sympathy_judaism
					trait = sympathy_indian
					any_liege = { holy_order = yes }
					any_liege = { mercenary = yes }
					any_spouse = {
						trait = pregnant
						father_of_unborn = { character = ROOT }
					}
					liege = {
						ai = no
						OR = {
							dynasty = ROOT
							is_close_relative = ROOT
						}
					}
					has_character_modifier = voice_of_satan
					has_character_modifier = planning_claimant_adventure
					has_character_flag = claimant_adventurer					
				}
			}
			modifier = {
				factor = 0
				NOR = {
					trait = detached_priest
					trait = martial_cleric
					trait = scholarly_theologian
					trait = mastermind_theologian
					AND = {
						trait = zealous
						trait = humble
					}
				}
			}
			modifier = {
				factor = 0.5
				NOR = {
					trait = detached_priest
					trait = martial_cleric
					trait = scholarly_theologian
					trait = mastermind_theologian
				}
			}
			modifier = {
				factor = 0
				any_heir_title = { always = yes }
				NAND = {
					calc_true_if = {
						amount = 2
						trait = zealous
						trait = humble
						trait = content
						trait = possessed
						has_character_modifier = voice_of_jesus
					}
					NOR = {
						trait = envious
						trait = greedy
					}
				}
			}
			modifier = {
				factor = 0
				any_pretender_title = { always = yes }
				NAND = {
					OR = {
						trait = zealous
						trait = humble
						trait = content
						trait = possessed
					}
					NOR = {
						trait = envious
						trait = greedy
					}
				}
			}
			modifier = {
				factor = 0
				is_married = yes
				NOR = {
					trait = zealous
					trait = lunatic
					trait = possessed
					has_called_crusade = yes
					NOT = { any_spouse = { reverse_opinion = { who = ROOT value = 0 } } }
				}
			}
		}
	}

	ai_desert_father_title_lose = {
		is_high_prio = yes
		potential = {
			ai = yes
			has_character_flag = is_desert_mother_father
			OR = {
				AND = {
					has_character_flag = title_desert_father
					NOT = { trait = desert_father }
				}
				AND = {
					has_character_flag = title_desert_mother
					NOT = { trait = desert_mother }
				}
				AND = {
					OR = {
						has_character_flag = title_desert_father
						has_character_flag = title_desert_mother
					}
					is_ruler = yes
				}
			}
		}
		allow = {
			always = yes
		}
		effect = {
			clr_character_flag = is_desert_mother_father
			if = {
				limit = { is_female = no }
				clr_character_flag = title_desert_father
				remove_special_character_title = DESERT_FATHER_TITLE
			}
			if = {
				limit = { is_female = yes }
				clr_character_flag = title_desert_mother
				remove_special_character_title = DESERT_MOTHER_TITLE
			}
		}
	}
	
	miaphysite_embrace_alexandrine = {
		potential = {
			is_ruler = yes
			learning = 12
			OR = {
				religion = miaphysite
				religion = monophysite
				religion = apostolic
				religion = paulician
				religion = tondrakian
				religion = monothelite
				religion = maronite
			}
			NOR = {
				trait = alexandrine
				trait = antiochene
			}
		}
		allow = {
			has_regent = no
			piety = 50
			NOT = { trait = zealous }
		}
		effect = {
			if = {
				limit = {
					num_of_count_titles = 1
					demesne_size = 1
				}
				economy_techpoints = 25
				military_techpoints = 25
			}
			add_trait = alexandrine
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.005
				always = yes
			}
			modifier = {
				factor = 10
				trait = cynical
			}
			modifier = {
				factor = 2
				learning = 10
			}
			modifier = {
				factor = 2
				learning = 12
			}
			modifier = {
				factor = 2
				learning = 14
			}
			modifier = {
				factor = 2
				learning = 16
			}
			modifier = {
				factor = 2
				learning = 18
			}
			modifier = {
				factor = 1.5
				liege = { trait = alexandrine }
			}
		}
	}

	miaphysite_embrace_antiochene = {
		potential = {	
			is_ruler = yes
			learning = 12
			OR = {
				religion = nestorian
				religion = messalian
				religion = maronite
			}
			NOR = {
				trait = alexandrine
				trait = antiochene
			}
		}
		
		allow = {
			has_regent = no
			piety = 50
			NOT = { trait = cynical }
		}
		
		effect = {
			piety = 100
			if = {
				limit = {
					num_of_count_titles = 1
					demesne_size = 1
				}
				culture_techpoints = 25
			}
			add_trait = antiochene
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.005
				always = yes
			}
			modifier = {
				factor = 10
				trait = zealous
			}
			modifier = {
				factor = 2
				learning = 10
			}
			modifier = {
				factor = 2
				learning = 12
			}
			modifier = {
				factor = 2
				learning = 14
			}
			modifier = {
				factor = 2
				learning = 16
			}
			modifier = {
				factor = 2
				learning = 18
			}
			modifier = {
				factor = 1.5
				liege = { trait = antiochene }
			}
		}
	}
	
	# Manichean
	
	organise_army_of_light = {
		is_high_prio = yes
		potential = {
			is_playable = yes
			higher_tier_than = COUNT
			religion = manichean
			NOT = { is_title_active = d_army_light }
			emf_hiprio_decision_basic_potential_trigger = yes
		}
		allow = {
			has_regent = no
			higher_tier_than = duke
			prestige = 300
			wealth = 300
		}
		effect = {
			prestige = -300
			wealth = -300
			activate_title = { title = d_army_light status = yes }
			hidden_tooltip = {
				narrative_event = { id = emf_heresy.229 }
				create_character = {
					random_traits = yes
					religion = ROOT
					culture = ROOT
					dynasty = random
					female = no
					age = 34
					trait = skilled_tactician
					trait = zealous
				}
				new_character = {
					d_army_light = {
						grant_title = PREV
					}
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				OR = {
					NOT = { prestige = 500 }
					NOT = { wealth = 500 }
				}
			}
		}
	}

	expel_army_of_light = {
		potential = {
			ai = no
			has_dlc = "Sons of Abraham"
			OR = {
				religion = manichean
				religion = mandaean
			}
			is_heretic = no
			higher_tier_than = DUKE
			independent = yes
			is_title_active = d_army_light
			NOT = { has_character_modifier = expelled_d_army_light }		
			any_realm_province = {
				any_province_lord = {
					d_army_light = {
						holder_scope = {
							OR = {
								character = PREVPREV
								is_vassal_or_below = PREVPREV
							}
						}
					}
				}
			}
		}
		allow = {
			piety = 1000
		}		
		effect = {
			piety = -1000		
			religion_authority = {
				modifier = holy_order_expelled
				years = 20
			}
			hidden_tooltip = {
				d_army_light = {
					holder_scope = {
						character_event = {
							id = emf_heresy.232
						}
					}
				}
				add_character_modifier = {
					name = expelled_d_army_light
					duration = -1
					inherit = yes
				}
			}
		}
		ai_will_do = {
			factor = 0
		}
	}
	
	donate_money_to_army_of_light = {
		potential = {
			is_ruler = yes
			has_dlc = "Sons of Abraham"
			OR = {
				religion = manichean
				religion = mandaean
			}
			is_heretic = no
			is_title_active = d_army_light
			NOR = { 
				has_character_modifier = expelled_d_army_light 
				has_character_modifier = donated_to_holy_order
				has_landed_title = d_army_light
			}
			d_army_light = {
				owner_under_ROOT = no
			}
		}
		allow = {
			wealth = 300
		}
		effect = {
			wealth = -300
			piety = 300
			if = {
				limit = { 
					NOT = { has_character_modifier = donated_to_holy_order }
				}
				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}
			hidden_tooltip = {
				d_army_light = {
					holder_scope = {
						character_event = {
							id = emf_heresy.230
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				OR = {
					trait = cynical
					trait = greedy
					piety = 1000
					NOT = { wealth = 1000 }
				}
			}
			modifier = {
				factor = 10
				trait = zealous
			}
			modifier = {
				factor = 10
				NOT = { piety = 100 }
			}
			modifier = {
				factor = 0.002 # Slow it down
			}
		}
	}

	vassalize_manichean_leader = {
		is_high_prio = yes
		icon_religion = manichean
		
		potential = {
			is_playable = yes
			religion = manichean
			controls_religion = no
			d_manichean = {
				has_holder = yes
				holder_scope = {
					independent = yes
					lower_tier_than = KING
					any_demesne_title = { controls_religion = no }
				}
			}
			emf_hiprio_decision_basic_potential_trigger = yes
		}
		allow = {
			war = no
			piety = 500
			higher_tier_than = DUKE
			any_realm_title = { is_holy_site = ROOT }
			religion_head = {
				war = no
				opinion = { who = ROOT value = 0 }
			}
		}
		effect = {
			piety = 500
			religion_head = {
				add_friend = ROOT
				ROOT = {
					random_realm_title = {
						limit = { is_holy_site = PREV }
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				emf_liege_change_effect = yes
			}
		}
		ai_will_do = {
			factor = 1
		}
	}

	
	# Mazdaki
	mazdaki_restore_priesthood = {
		is_high_prio = yes
		icon_religion = mazdaki
		
		potential = {
			is_playable = yes
			has_dlc = "The Old Gods"
			religion = mazdaki
			NOR = {
				any_demesne_title = { temporary = yes }
				is_title_active = d_mazdaki
			}
			emf_hiprio_decision_basic_potential_trigger = yes
		}
		allow = {
			war = no
			has_regent = no
			independent = yes
			trait = zealous
			num_of_holy_sites = 1
			piety = 1000
			prestige = 1000
		}
		effect = {
			prestige = 500
			activate_title = { title = d_mazdaki status = yes }
			narrative_event = { id = emf_heresy.258 tooltip = RESTORE_MAZDAKI_PRIESTHOOD }
		}
		ai_will_do = {
			factor = 1
		}
	}

	mazdaki_choose_patron_deity = {
		icon_religion = mazdaki
		
		potential = {
			religion = mazdaki
			OR = {
				is_playable = yes
				capital_holding = { holding_type = temple }
				trait = detached_priest
				trait = martial_cleric
				trait = scholarly_theologian
				trait = mastermind_theologian
			}
			NOR = {
				has_character_modifier = patron_discernment
				has_character_modifier = patron_understanding
				has_character_modifier = patron_preservation
				has_character_modifier = patron_joy
			}
		}
		allow = {
			war = no
			is_adult = yes
			prisoner = no
			NOT = { trait = incapable }
		}
		effect = {
			character_event = { id = emf_heresy.259 tooltip = choose_mazdaki_patron }
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				always = yes
			}
			modifier = {
				factor = 5
				trait = zealous
			}
			modifier = {
				factor = 0.5
				trait = cynical
			}
		}
	}	

	
	# Yazidi
	yazidi_peacock_feast = {
		potential = {
			is_playable = yes
			religion = yazidi
			num_of_vassals = 1
			OR = {
				is_feudal = yes
				is_tribal = yes
				is_nomadic = yes
				is_patrician = yes
			}			
			NOR = {
				trait = in_hiding
				any_demesne_title = { is_occupied = yes }
				has_character_flag = planning_peacock_feast
				has_character_flag = holding_peacock_feast
				liege = { has_character_flag = holding_peacock_feast }
			}
			OR = {
				NOT = { has_character_flag = held_recent_feast }
				had_character_flag = { flag = held_recent_feast days = 365 }
			}
		}
		allow = {
			war = no
			has_regent = no
			scaled_wealth = 0.5
			prestige = 100
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { emf_can_disturb_trigger = yes }
			}
			custom_tooltip = {
				text = HAS_THREE_YAZIDI_VASSALS_AVAILABLE
				hidden_tooltip = {
					any_vassal = {
						religion = yazidi
						prisoner = no
						NOT = { trait = incapable }
						emf_can_disturb_trigger = yes
						war = no
						is_adult = yes
						count = 3
					}
				}
			}
		}
		effect = {
			scaled_wealth = -0.5
			set_character_flag = planning_peacock_feast
			hidden_tooltip = {
				character_event = { id = emf_heresy.260 }
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
				always = yes
			}
			modifier = {
				factor = 0
				OR = {
					NOT = { month = 5 }
					month = 10
				}
			}
			modifier = {
				factor = 0
				NOT = { scaled_wealth = 5.0 }
				NOR = {
					trait = charitable
					trait = gregarious
					trait = gluttonous
					trait = zealous
				}
			}
			modifier = {
				factor = 0
				NOT = { scaled_wealth = 2.5 }
			}
			modifier = {
				factor = 0
				OR = {
					trait = shy
					trait = greedy
					trait = paranoid
				}
			}	
			modifier = {
				factor = 0
				has_character_flag = held_recent_feast
				NOT = { had_character_flag = { flag = held_recent_feast days = 1825 } }
			}
		}
	}

	yazidi_pilgrimage = {
		potential = {
			is_ruler = yes
			religion = yazidi
			is_female = no
			NOR = {
				trait = in_hiding
				trait = yazidi_pilgrim
				trait = on_pilgrimage
				any_demesne_title = { is_occupied = yes }
				has_character_flag = preparing_yazidi_pilgrimage
				has_character_flag = planning_peacock_feast
			}
		}
		allow = {
			war = no
			has_regent = no
			scaled_wealth = 1.0
			custom_tooltip = {
				text = health_travel_condition
				hidden_tooltip = {
					is_pregnant = no
					NOT = {	trait = incapable }
					NOT = { trait = infirm }
					NOT = {	trait = blinded }
					is_ill = no
				}
			}
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { emf_can_disturb_trigger = yes }
			}
		}
		effect = {
			set_character_flag = preparing_yazidi_pilgrimage
			scaled_wealth = -1.0
			custom_tooltip = {
				text = PREPARE_FOR_PILGRIMAGE
				hidden_tooltip = {
					character_event = { id = emf_heresy.279 }
				}
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				OR = {
					NOT = { month = 7 }
					month = 9
				}
			}
			modifier = {
				factor = 0
				trait = cynical
			}
			modifier = {
				factor = 0
				OR = {
					trait = slothful
					trait = proud
					trait = deceitful
				}
				NOT = { trait = decadent }
			}
			modifier = {
				factor = 0
				NOT = { scaled_wealth = 5.0 }
			}
			modifier = { # Monthly randomizer for when AI takes decision (5% chance)
				factor = 0
				random = 5
			}
			modifier = {
				factor = 0
				NOT = { age = 30 }
			}
		}
	}
}