###########################################
#                                         #
#  Melting-pot events                  	  #
#                                         #
#  Written by Loup          			  #
#                                         #
###########################################

namespace = WtWSMS_pots

###############################
# Initial melting-pot target flag
###############################

# New Pagan, Tribal and Germanic ruler holding a Christian, sub-Roman and Feudal province, making it a melting-pot target
province_event = {
	id = WtWSMS_pots.1

	hide_window = yes	
	
	only_rulers = yes

	trigger = {
		owner = { 
			religion_group = pagan_group
			is_tribal = yes
			has_germanic_culture_trigger = yes 
		}
		religion_group = christian
		is_feudal = yes
		has_romance_culture_trigger = yes
		NOR = { 
			any_province_holding = {
				has_holding_modifier = recently_conquered
			} 
		}
	}
	
	mean_time_to_happen = {
		years = 1 # Testing placeholder
	}
	
	immediate = {
		set_province_flag = melting_pot_target
	}
}

# The ruler is no longer Pagan, Tribal and Germanic, meaning the province held should no longer be a melting-pot target
province_event = {
	id = WtWSMS_pots.2

	hide_window = yes	
	
	only_rulers = yes

	trigger = {
		has_province_flag = melting_pot_target
		NAND = { 
			owner = { 
				religion_group = pagan_group
				is_tribal = yes
				has_germanic_culture_trigger = yes 
			}
		}
	}
	
	mean_time_to_happen = {
		years = 1 # Testing placeholder
	}
	
	immediate = {
		clr_province_flag = melting_pot_target
	}
}

# The province is no longer Christian, sub-Roman or Feudal, meaning it is no longer eligible as a melting-pot target
province_event = {
	id = WtWSMS_pots.3

	hide_window = yes	
	
	only_rulers = yes

	trigger = {
		has_province_flag = melting_pot_target
		NOR = { 
			religion_group = christian
			is_feudal = yes
			has_romance_culture_trigger = yes
		}
	}
	
	mean_time_to_happen = {
		years = 1 # Testing placeholder
	}
	
	immediate = {
		clr_province_flag = melting_pot_target
	}
}

###############################
# Conversion to Christianity
###############################

# Spread of Christianity
province_event = {
	id = WtWSMS_pots.4
	title = WtWSMS_pots.4.name
	desc = WtWSMS_pots.4.desc
	picture = GFX_evt_stone_church
	border = GFX_event_normal_frame_religion
	
	only_rulers = yes
	
	trigger = { 
		owner = { 
			religion_group = pagan_group
			is_tribal = yes
			has_germanic_culture_trigger = yes 
		}
		religion_group = christian
		is_feudal = yes
		has_romance_culture_trigger = yes
		NOR = { 
			any_province_holding = {
				has_holding_modifier = recently_conquered
			} 
		}
		has_province_flag = melting_pot_target
	}

	mean_time_to_happen = {
		years = 1 # Testing placeholder
	}
	
	immediate = {
		set_province_flag = spread_of_christianity
	}
	
	option = {
		name = WtWSMS_pots.4.a # OK
	}
}

# Mighty Christian landed vassal has a Pagan liege
character_event = {
	id = WtWSMS_pots.5
	title = WtWSMS_pots.5.name
	desc = WtWSMS_pots.5.desc
	picture = GFX_evt_stone_church
	border = GFX_event_normal_frame_religion
	
	only_playable = yes
	
	trigger = {
		liege = {
			any_demesne_province = {
				has_province_flag = spread_of_christianity
				has_province_flag = melting_pot_target
			}
			is_adult = yes
			is_incapable = no
			prisoner = no
			NOT = { has_character_flag = refused_conversion_christianity }
		}
		religion_group = christian
		relative_power_to_liege = 0.1 # Testing placeholder
		is_theocracy = no
		is_adult = yes
		is_incapable = no
		prisoner = no
	}
	
	mean_time_to_happen = {
		years = 1 # Testing placeholder
	}
	
	option = {
		name = WtWSMS_pots.5.a # Try to convince the liege to convert
		ai_chance = {
			factor = 10
			modifier = {
				factor = 5
				trait = zealous
			}
		}
		liege = {
			character_event = { 
				id = WtWSMS_pots.6
				days = 5
			}
		}
	}
	
	option = {
		name = WtWSMS_pots.5.b # Not worth it
	}
}

# Mighty Christian landed vassal brings it up with Pagan liege
character_event = {
	id = WtWSMS_pots.6
	title = WtWSMS_pots.6.name
	desc = WtWSMS_pots.6.desc
	picture = GFX_evt_stone_church
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = WtWSMS_pots.6.a # Embrace the religion
		trigger = {
			NOT = { trait = zealous }
		}
		ROOT = {
			religion = FROM
			religion_authority = {
				modifier = ruler_converted_from
			}
			if = {
				limit = {
					trait = cynical
				}
				random = {
					chance = 60
					add_trait = sympathy_pagans
				}
			}
			if = {
				limit = {
					NOT = { trait = cynical }
				}
				random = {
					chance = 50
					add_trait = sympathy_pagans
				}
			}		
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
			piety = 200
			character_event = {
				id = WtWSMS_pots.16
			}
		}
	}
	
	option = {
		name = WtWSMS_pots.6.b # Make vague statement
		character_event = { 
			id = WtWSMS_pots.14 # Insists after first step
			days = 100
		}
	}

	option = {
		name = WtWSMS_pots.6.c # Refuse
		set_character_flag = refused_conversion_christianity
	}
}

# Bishop from the realm has a Pagan liege
character_event = {
	id = WtWSMS_pots.7
	title = WtWSMS_pots.7.name
	desc = WtWSMS_pots.7.desc
	picture = GFX_evt_stone_church
	border = GFX_event_normal_frame_religion
	
	only_playable = yes
	
	trigger = {
		liege = {
			any_demesne_province = {
				has_province_flag = spread_of_christianity
				has_province_flag = melting_pot_target
			}
			is_adult = yes
			is_incapable = no
			prisoner = no
			NOT = { has_character_flag = refused_conversion_christianity }
		}
		religion_group = christian
		is_theocracy = yes
		is_adult = yes
		is_incapable = no
		prisoner = no
	}
	
	mean_time_to_happen = {
		years = 1 # Testing placeholder
	}
	
	option = {
		name = WtWSMS_pots.7.a # Try to convince the liege to convert
		ai_chance = {
			factor = 10
			modifier = {
				factor = 5
				trait = zealous
			}
		}
		liege = {
			character_event = { 
				id = WtWSMS_pots.8
				days = 5
			}
		}
	}
	
	option = {
		name = WtWSMS_pots.7.b # Not worth it
	}
}

# Bishop from the realm visits your court
character_event = {
	id = WtWSMS_pots.8
	title = WtWSMS_pots.8.name
	desc = WtWSMS_pots.8.desc
	picture = GFX_evt_stone_church
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = WtWSMS_pots.8.a # Embrace the religion
		trigger = {
			NOT = { trait = zealous }
		}
		ROOT = {
			religion = FROM
			religion_authority = {
				modifier = ruler_converted_from
			}
			if = {
				limit = {
					trait = cynical
				}
				random = {
					chance = 60
					add_trait = sympathy_pagans
				}
			}
			if = {
				limit = {
					NOT = { trait = cynical }
				}
				random = {
					chance = 50
					add_trait = sympathy_pagans
				}
			}		
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
			piety = 200
			character_event = {
				id = WtWSMS_pots.16
			}
		}
	}
	
	option = {
		name = WtWSMS_pots.8.b # Make vague statement
		character_event = { 
			id = WtWSMS_pots.14 # Insists after first step
			days = 100
		}
	}

	option = {
		name = WtWSMS_pots.8.c # Refuse
		set_character_flag = refused_conversion_christianity
	}
}

# Wife is a Christian
character_event = {
	id = WtWSMS_pots.9
	title = WtWSMS_pots.9.name
	desc = WtWSMS_pots.9.desc
	picture = GFX_evt_stone_church
	border = GFX_event_normal_frame_religion
	
	only_rulers = yes
	
	trigger = {
		any_demesne_province = {
			has_province_flag = spread_of_christianity
			has_province_flag = melting_pot_target
		}
		is_adult = yes
		is_incapable = no
		prisoner = no
		NOT = { has_character_flag = refused_conversion_christianity }
		any_spouse = {
			religion_group = christian
			is_adult = yes
			is_incapable = no
			prisoner = no
			is_abroad = no
			is_alive = yes
		}
	}
	
	mean_time_to_happen = {
		years = 1 # Testing placeholder
	}
	
	immediate = {
		any_spouse = {
			limit = {
				religion_group = christian
				is_adult = yes
				is_incapable = no
				prisoner = no
				is_abroad = no
				is_alive = yes
			}
			save_event_target_as = christian_wife
		}
	}

	option = {
		name = WtWSMS_pots.9.a # Yes, my love
		trigger = {
			NOT = { trait = zealous }
		}
		ROOT = {
			event_target:christian_wife = {
				reverse_religion = PREV
			}
			religion_authority = {
				modifier = ruler_converted_from
			}
			if = {
				limit = {
					trait = cynical
				}
				random = {
					chance = 60
					add_trait = sympathy_pagans
				}
			}
			if = {
				limit = {
					NOT = { trait = cynical }
				}
				random = {
					chance = 50
					add_trait = sympathy_pagans
				}
			}		
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
			piety = 200
			character_event = {
				id = WtWSMS_pots.16
			}
		}
	}
	
	option = {
		name = WtWSMS_pots.9.b # We will see, my dear
		character_event = { 
			id = WtWSMS_pots.14 # Insists after first step
			days = 100
		}
	}

	option = {
		name = WtWSMS_pots.9.c # How dare you?
		set_character_flag = refused_conversion_christianity
	}
}

# Concubine is a Christian
character_event = {
	id = WtWSMS_pots.10
	title = WtWSMS_pots.10.name
	desc = WtWSMS_pots.10.desc
	picture = GFX_evt_stone_church
	border = GFX_event_normal_frame_religion
	
	only_rulers = yes
	
	trigger = {
		any_demesne_province = {
			has_province_flag = spread_of_christianity
			has_province_flag = melting_pot_target
		}
		is_adult = yes
		is_incapable = no
		prisoner = no
		NOT = { has_character_flag = refused_conversion_christianity }
		any_consort = { # Scopes to all of a character's consorts (not only concubines, works for both genders)
			religion_group = christian
			is_adult = yes
			is_incapable = no
			prisoner = no
			is_consort = yes # Checks if THIS is a concubine, or a concubine or the specified character
			is_abroad = no
			is_alive = yes
		}
	}
	
	mean_time_to_happen = {
		years = 1 # Testing placeholder
	}
	
	immediate = {
		any_consort = { 
			limit = {
				religion_group = christian
				is_adult = yes
				is_incapable = no
				prisoner = no
				is_consort = yes 
				is_abroad = no
				is_alive = yes
			}
			save_event_target_as = christian_concubine
		}
	}

	option = {
		name = WtWSMS_pots.10.a # Yes, my love
		trigger = {
			NOT = { trait = zealous }
		}
		ROOT = {
			event_target:christian_concubine = {
				reverse_religion = PREV
			}
			religion_authority = {
				modifier = ruler_converted_from
			}
			if = {
				limit = {
					trait = cynical
				}
				random = {
					chance = 60
					add_trait = sympathy_pagans
				}
			}
			if = {
				limit = {
					NOT = { trait = cynical }
				}
				random = {
					chance = 50
					add_trait = sympathy_pagans
				}
			}		
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
			piety = 200
			character_event = {
				id = WtWSMS_pots.16
			}
		}
	}
	
	option = {
		name = WtWSMS_pots.10.b # We will see, my dear
		character_event = { 
			id = WtWSMS_pots.14 # Insists after first step
			days = 100
		}
	}

	option = {
		name = WtWSMS_pots.10.c # How dare you?
		set_character_flag = refused_conversion_christianity
	}
}

# Courtier speaks to you about Christianity
character_event = {
	id = WtWSMS_pots.11
	title = WtWSMS_pots.11.name
	desc = WtWSMS_pots.11.desc
	picture = GFX_evt_stone_church
	border = GFX_event_normal_frame_religion
	
	only_playable = yes
	
	trigger = {
		any_demesne_province = {
			has_province_flag = spread_of_christianity
			has_province_flag = melting_pot_target
		}
		is_adult = yes
		is_incapable = no
		prisoner = no
		NOT = { has_character_flag = refused_conversion_christianity }
		any_courtier = { 
			religion_group = christian
			is_adult = yes
			is_incapable = no
			prisoner = no
			has_job_title = no # That one is done separately
			is_landed = no # This is meant to be for a courtier
		}
	}
	
	mean_time_to_happen = {
		years = 1 # Testing placeholder
	}
	
	immediate = {
		any_courtier = { 
			limit = {
				religion_group = christian
				is_adult = yes
				is_incapable = no
				prisoner = no
				has_job_title = no
				is_landed = no
			}
			save_event_target_as = christian_courtier
		}
	}

	option = {
		name = WtWSMS_pots.11.a # Embrace the religion
		trigger = {
			NOT = { trait = zealous }
		}
		ROOT = {
			event_target:christian_courtier = {
				reverse_religion = PREV
			}
			religion_authority = {
				modifier = ruler_converted_from
			}
			if = {
				limit = {
					trait = cynical
				}
				random = {
					chance = 60
					add_trait = sympathy_pagans
				}
			}
			if = {
				limit = {
					NOT = { trait = cynical }
				}
				random = {
					chance = 50
					add_trait = sympathy_pagans
				}
			}		
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
			piety = 200
			character_event = {
				id = WtWSMS_pots.16
			}
		}
	}
	
	option = {
		name = WtWSMS_pots.11.b # Make vague statement
		character_event = { 
			id = WtWSMS_pots.14 # Insists after first step
			days = 100
		}
	}

	option = {
		name = WtWSMS_pots.11.c # Refuse
		set_character_flag = refused_conversion_christianity
	}
}

# Christian Councillour
character_event = {
	id = WtWSMS_pots.12
	title = WtWSMS_pots.12.name
	desc = WtWSMS_pots.12.desc
	picture = GFX_evt_stone_church
	border = GFX_event_normal_frame_religion
	
	only_playable = yes
	
	trigger = {
		any_demesne_province = {
			has_province_flag = spread_of_christianity
			has_province_flag = melting_pot_target
		}
		is_adult = yes
		is_incapable = no
		prisoner = no
		NOT = { has_character_flag = refused_conversion_christianity }
		any_courtier = { 
			religion_group = christian
			is_adult = yes
			is_incapable = no
			prisoner = no
			has_job_title = yes # Want it to be a councillour
		}
	}
	
	mean_time_to_happen = {
		years = 1 # Testing placeholder
	}
	
	immediate = {
		any_courtier = { 
			limit = {
				religion_group = christian
				is_adult = yes
				is_incapable = no
				prisoner = no
				has_job_title = yes 
			}
			save_event_target_as = christian_councillour
		}
	}

	option = {
		name = WtWSMS_pots.12.a # Embrace the religion
		trigger = {
			NOT = { trait = zealous }
		}
		ROOT = {
			event_target:christian_councillour = {
				reverse_religion = PREV
			}
			religion_authority = {
				modifier = ruler_converted_from
			}
			if = {
				limit = {
					trait = cynical
				}
				random = {
					chance = 60
					add_trait = sympathy_pagans
				}
			}
			if = {
				limit = {
					NOT = { trait = cynical }
				}
				random = {
					chance = 50
					add_trait = sympathy_pagans
				}
			}		
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
			piety = 200
			character_event = {
				id = WtWSMS_pots.16
			}
		}
	}
	
	option = {
		name = WtWSMS_pots.12.b # Make vague statement
		character_event = { 
			id = WtWSMS_pots.14 # Insists after first step
			days = 100
		}
	}

	option = {
		name = WtWSMS_pots.12.c # Refuse
		set_character_flag = refused_conversion_christianity
	}
}

# Christian missionary from foreign realm travels to your court
character_event = {
	id = WtWSMS_pots.13
	title = WtWSMS_pots.13.name
	desc = WtWSMS_pots.13.desc
	picture = GFX_evt_stone_church
	border = GFX_event_normal_frame_religion
	
	only_rulers = yes
	
	trigger = {
		any_demesne_province = {
			has_province_flag = spread_of_christianity
			has_province_flag = melting_pot_target
		}
		is_adult = yes
		is_incapable = no
		prisoner = no
		NOT = { has_character_flag = refused_conversion_christianity }
		any_neighbor_independent_ruler = {
			any_realm_character	= {
				religion_group = christian
				is_adult = yes
				is_incapable = no
				prisoner = no
				is_priest = yes
			}
		}		
	}

	mean_time_to_happen = {
		years = 1 # Testing placeholder
	}
	
	immediate = {
		any_neighbor_independent_ruler = {
			limit = { 
				any_realm_character	= { 
					religion_group = christian
					is_adult = yes
					is_incapable = no
					prisoner = no
					is_priest = yes
				}
			}
			save_event_target_as = christian_missionary
		}
	}
	
	option = {
		name = WtWSMS_pots.13.a # Embrace the religion
		trigger = {
			NOT = { trait = zealous }
		}
		ROOT = {
			event_target:christian_missionary = {
				reverse_religion = PREV
			}
			religion_authority = {
				modifier = ruler_converted_from
			}
			if = {
				limit = {
					trait = cynical
				}
				random = {
					chance = 60
					add_trait = sympathy_pagans
				}
			}
			if = {
				limit = {
					NOT = { trait = cynical }
				}
				random = {
					chance = 50
					add_trait = sympathy_pagans
				}
			}		
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
			piety = 200
			character_event = {
				id = WtWSMS_pots.16
			}
		}
	}
	
	option = {
		name = WtWSMS_pots.13.b # Make vague statement
		character_event = { 
			id = WtWSMS_pots.14 # Insists after first step
			days = 100
		}
	}

	option = {
		name = WtWSMS_pots.13.c # Refuse
		set_character_flag = refused_conversion_christianity
	}
}

# Insists after first step
character_event = {
	id = WtWSMS_pots.14
	title = WtWSMS_pots.14.name
	desc = WtWSMS_pots.14.desc
	picture = GFX_evt_stone_church
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = WtWSMS_pots.14.a # Convert
		ai_chance = {
			#Option A modifiers
		}
		ROOT = {
			FROMFROM = {
				reverse_religion = PREV
			}
			event_target:christian_wife = {
				reverse_religion = PREV
			}
			event_target:christian_concubine = {
				reverse_religion = PREV
			}
			event_target:christian_courtier = {
				reverse_religion = PREV
			}
			event_target:christian_councillour = {
				reverse_religion = PREV
			}
			event_target:christian_missionary = {
				reverse_religion = PREV
			}
			religion_authority = {
				modifier = ruler_converted_from
			}
			if = {
				limit = {
					trait = cynical
				}
				random = {
					chance = 60
					add_trait = sympathy_pagans
				}
			}
			if = {
				limit = {
					NOT = { trait = cynical }
				}
				random = {
					chance = 50
					add_trait = sympathy_pagans
				}
			}		
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
			piety = 200
			character_event = {
				id = WtWSMS_pots.16
			}
		}
	}
	
	option = {
		name = WtWSMS_pots.14.b # Refuse
		ai_chance = {
			#Option B modifiers
		}
		set_character_flag = refused_conversion_christianity
	}
}

# Won major battle with the "help" of the Christian god
character_event = {
	id = WtWSMS_pots.15
	id = WtWSMS_pots.15.desc
	picture = GFX_evt_stone_church # To change
	border = GFX_event_normal_frame_religion
	
	hide_FROM = yes
	
	is_triggered_only = yes # On_actions event
	
	trigger = {
		any_demesne_province = {
			has_province_flag = spread_of_christianity
			has_province_flag = melting_pot_target
		}
		is_adult = yes
		is_incapable = no
		prisoner = no
		NOT = { has_character_flag = refused_conversion_christianity }
	}
		
	option = {
		name = WtWSMS_pots.15.a # Convert
		ai_chance = {
			#Option A modifiers
		}
		ROOT = {
			any_demesne_province = {
				limit = {
						has_province_flag = spread_of_christianity
						has_province_flag = melting_pot_target
				}
				save_event_target_as = christian_province
			}
			religion = event_target:christian_province
			religion_authority = {
				modifier = ruler_converted_from
			}
			if = {
				limit = {
					trait = cynical
				}
				random = {
					chance = 60
					add_trait = sympathy_pagans
				}
			}
			if = {
				limit = {
					NOT = { trait = cynical }
				}
				random = {
					chance = 50
					add_trait = sympathy_pagans
				}
			}		
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
			piety = 200
			character_event = {
				id = WtWSMS_pots.16
			}
		}
	}
	
	# Option to wait with conversion?
	
	option = {
		name = WtWSMS_pots.15.b # Refuse
		ai_chance = {
			#Option B modifiers
		}
		set_character_flag = refused_conversion_christianity
	}
}

# Conversion to Christianity
character_event = {
	id = WtWSMS_pots.16
	title = WtWSMS_pots.16.name
	desc = WtWSMS_pots.16.desc
	picture = GFX_evt_stone_church
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		any_realm_province = { # Set flag to give away land
			limit = {
				has_province_flag = spread_of_christianity 
			}
			clr_province_flag = spread_of_christianity
		}
	}
	
	option = {
		name = WtWSMS_pots.16.a # OK
	}
}
